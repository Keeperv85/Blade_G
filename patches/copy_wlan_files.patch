From 273e80b2236381f3591c68e11491b10ad53a64e0 Mon Sep 17 00:00:00 2001
From: Keeperv85 <v8506reborn@hotmail.com>
Date: Sat, 14 Jun 2014 21:03:31 +0200
Subject: [PATCH 1/2] Copy wlan firmware

Change-Id: I3946cc21c785d57846c20f920c4f2db97b01223c
---
 tools/releasetools/edify_generator.py    |    4 ++++
 tools/releasetools/ota_from_target_files |    1 +
 2 files changed, 5 insertions(+)

diff --git a/tools/releasetools/edify_generator.py b/tools/releasetools/edify_generator.py
index c8de69a..1776e19 100644
--- a/tools/releasetools/edify_generator.py
+++ b/tools/releasetools/edify_generator.py
@@ -111,6 +111,10 @@ class EdifyGenerator(object):
         self.script.append('delete("/system/bin/backuptool.sh");')
         self.script.append('delete("/system/bin/backuptool.functions");')
 
+  def Add_Wlan_Files(self, customstrings):
+    self.script.append('run_program("/sbin/busybox", "cp", "-f", "/persist/bdata.bin", "/system/etc/firmware/ath6k/AR6003/hw2.1.1/bdata.bin");')
+    self.script.append('run_program("/sbin/busybox", "cp", "-f", "/persist/msm7627a_qcom_wlan_nv.bin", "/system/etc/firmware/wlan/volans/WCN1314_qcom_wlan_nv.bin");')
+
   def ShowProgress(self, frac, dur):
     """Update the progress bar, advancing it over 'frac' over the next
     'dur' seconds.  'dur' may be zero to advance it via SetProgress
diff --git a/tools/releasetools/ota_from_target_files b/tools/releasetools/ota_from_target_files
index 93d1c23..867f198 100755
--- a/tools/releasetools/ota_from_target_files
+++ b/tools/releasetools/ota_from_target_files
@@ -422,6 +422,7 @@ def WriteFullOTAPackage(input_zip, output_zip):
   script.Mount("/system")
   #script.UnpackPackageDir("recovery", "/system")
   script.UnpackPackageDir("system", "/system")
+  script.Add_Wlan_Files("customstrings")
 
   symlinks = CopySystemFiles(input_zip, output_zip)
   script.MakeSymlinks(symlinks)
-- 
1.7.9.5


From 8edc70144f9da2f93d7d9af9b2ed83c538aa415c Mon Sep 17 00:00:00 2001
From: Keeperv85 <v8506reborn@hotmail.com>
Date: Sun, 15 Jun 2014 10:25:15 +0200
Subject: [PATCH 2/2] Copy wlan firmware

Change-Id: Ied5507bbb1fa5b3f54fb3d568d86aaeb2cad1c67
---
 tools/releasetools/ota_from_target_files |    1 +
 1 file changed, 1 insertion(+)

diff --git a/tools/releasetools/ota_from_target_files b/tools/releasetools/ota_from_target_files
index 867f198..7296ffc 100755
--- a/tools/releasetools/ota_from_target_files
+++ b/tools/releasetools/ota_from_target_files
@@ -420,6 +420,7 @@ def WriteFullOTAPackage(input_zip, output_zip):
 
   script.FormatPartition("/system")
   script.Mount("/system")
+  script.Mount("/persist")
   #script.UnpackPackageDir("recovery", "/system")
   script.UnpackPackageDir("system", "/system")
   script.Add_Wlan_Files("customstrings")
-- 
1.7.9.5

